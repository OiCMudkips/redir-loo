<!DOCTYPE html>
<head>
    <title>redir-loo | My Links</title>
    <meta charset="UTF-8"/>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed&subset=latin,latin-ext" rel="stylesheet" type="text/css"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css" rel="stylesheet" type="text/css"/>
    <link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    {>header}
    
    <div id="content">
    <h1>{user}'s Links</h1>
    {if rows.length}
    <button class="open-popup">Add Link</button>
    <table>
        <tr><th>Destination</th><th>Shortened Link</th></tr>
        {for row in rows}
        <tr>
            <td>{row.url}</td>
            <td>http://placeholder.com/{row.shortened}</td>
        </tr>
        {/for}
    </table>
    <button class="open-popup">Add Link</button>
    {else}
    <p>We didn't find any links for you. Add one now!</p>
    <button class="open-popup">Add Link</button>
    {/if}
    
    {>footer}

    <div id="add-link-overlay" style="display: none">
        <button id="close-overlay">X</button>
        <input id="url" type="url" autocomplete="url">
        <button id="add-link">Add</button>
    </div>
    
    <script>
        var openPopup = function() {
            document.getElementById("add-link-overlay").style.display = "block";
        };

        var closePopup = function() {
            document.getElementById("add-link-overlay").style.display = "none";
        };

        var showLoading = function() {
            // TODO: show a loading image or something
        };

        var hideLoading = function() {
            // TODO: hdie a loading image or something
        };

        var postLink = function(url) {
            showLoading();
            var request = new XMLHttpRequest();
            var url = document.getElementById("url").value;

            request.open("POST", "/create-link", true);
            request.setRequestHeader("Content-type", "application/json");
            request.send(JSON.stringify({ url: url }));
            hideLoading();
        };

        var overlayOpeners = document.getElementsByClassName("open-popup");
        Array.prototype.forEach.call(overlayOpeners, function(current) {
            current.addEventListener("click", openPopup);
        });
        document.getElementById("close-overlay").addEventListener("click", closePopup);
        document.getElementById("add-link").addEventListener("click", postLink);
    </script>
</body>
